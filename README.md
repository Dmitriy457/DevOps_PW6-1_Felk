### Фельк Дмитрий Александрович ФИТ-2-2024 НМ



# Практическая работа 6-1. Деплой веб-сервера с помощью Ansible.

#### <u>Задание:</u> 

1. #### Сделать role, которая устанавливает nginx c vhosts
2. #### Роль устанавливает nginx
3. #### Виртуальные сайты задавать параметрами роли (playbook/play/vars)

  #### 	Пример:

  #### 		var:

  #### 			sites:

  #### 			– iknt.ru

  #### 			– fizmat.ru

  #### 			– etis.com
4. #### Для каждого vhost из шаблона index.html.j2 создавать индексный файл
5. #### Для каждого vhost из шаблона {{site}}.conf.j2 создавать конфигурацию веб-сервера
6. #### Проверка через curl или браузер с подменой DNS



Структура будущей роли:

![image-20251016094829451](assets/image-20251016094829451.png)



Прописываем задачу установки nginx на хост:

![image-20251016095056748](assets/image-20251016095056748.png)



Копирование в цикле конфига для виртуального хоста, каждый раз с новым именем и с новым содержимым:

![image-20251016103331720](assets/image-20251016103331720.png)



Заполняем конфиг виртуального хоста vhost:

![image-20251016100840325](assets/image-20251016100840325.png)



Заполняем шаблон стартовой страницы vhost:

![image-20251016101214484](assets/image-20251016101214484.png)



Копирование стартовых страниц в цикле в каждый виртуальный сайт:

![image-20251016102257895](assets/image-20251016102257895.png)



Перезагрузка nginx путем добавления таски в tasks/main.yml:

![image-20251016103250434](assets/image-20251016103250434.png)



Заполняем плейбук:

![image-20251016105811482](assets/image-20251016105811482.png)



Создаем скрипт для запуска плейбука с ролью:

![image-20251023083125030](assets/image-20251023083125030.png)



Запускаем плейбук:

![image-20251023084917177](assets/image-20251023084917177.png)



Правим файл /etc/hosts:

![image-20251023085245737](assets/image-20251023085245737.png)



Проверка из командной строки
